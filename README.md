## 주제 소개

K_Pay는 **안정적인 결제 처리와 정산/환불 프로세스를 지원하는 축소판 결제 플랫폼**으로, 금융 서비스의 핵심 요소를 단순화된 형태로 구현하는 것을 목표로 한다. 본 프로젝트는 단순 기능 구현이 아니라 **재사용성과 유지보수성을 높이는 아키텍처 설계**에 중점을 두며, 다음과 같은 문제를 해결하고자 한다:

1. **결제 안정성 확보**
    - 동일 결제 요청의 중복 처리 문제를 방지하기 위해 **Idempotency Key** 기반 요청 처리 설계를 적용한다.
    - 결제 도중 부분 실패가 발생할 경우를 대비해 **Saga 패턴**을 적용하여 보상 트랜잭션을 통해 데이터 무결성을 유지한다.
2. **정산 및 환불 프로세스 구현**
    - **Double-entry accounting(이중부기)** 방식을 채택해 거래 무결성을 보장한다.
    - 정산은 Batch Job으로 주간/월간 단위 처리, 환불은 이벤트 기반으로 정산 롤백까지 고려한다.
3. **대규모 트래픽 대응**
    - Redis 기반 분산락과 캐시로 동시성 문제를 해결한다.
    - RabbitMQ 기반 이벤트 드리븐 아키텍처를 도입해 서비스 간 결합도를 낮추고 확장성을 확보한다.
4. **운영 및 모니터링 체계**
    - Prometheus + Grafana를 통한 TPS, 실패율 모니터링
    - ELK 스택을 통한 거래 로그 수집 및 분석
    - 이상 거래 탐지를 위한 알람 시스템 설계
5. **멀티모듈 설계**
    - 멀티 모듈 간에 메시지 큐 기반으로 최대한 서비스의 결합도를 낮추었다.
6. RedLock
    - Redis 서버가 **단일 장애점(SPOF)** 이 됨 → 서버가 죽으면 락 정보가 날아가서 **동시성 제어 실패** 가능.
    - Redis 클러스터를 써도 노드 장애 시 **failover 시점에 락 유실** 가능으로 RedLock 사용
  

<img width="1084" height="1052" alt="image" src="https://github.com/user-attachments/assets/8f7be1f7-1341-42ce-a60e-64dd79cc14a3" />
<img width="1290" height="1239" alt="image" src="https://github.com/user-attachments/assets/62a29103-adcf-41d1-9d7f-d82b9dd610c2" />
